<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ألعاب الشايب</title>
  <!-- Font Awesome للأيقونات -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- خط Tajawal العربي -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2196F3;
      --secondary-color: #FF4081;
      --accent-color: #4CAF50;
      --background-color: #f5f7fa;
      --text-color: #333;
      --card-bg: white;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, rgba(245, 247, 250, 0.95), rgba(230, 236, 245, 0.95)),
                  url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23a3bce0' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      background-attachment: fixed;
      color: var(--text-color);
      direction: rtl;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
      padding-top: 2.5rem;
    }

    h1 {
      font-size: 3rem;
      font-weight: bold;
      color: white;
      background-color: var(--secondary-color);
      display: inline-block;
      padding: 0.5rem 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .subtitle {
      font-size: 1.5rem;
      background-color: rgba(255, 255, 255, 0.8);
      color: #333;
      border-radius: 2rem;
      padding: 0.5rem 1.5rem;
      display: inline-block;
    }

    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .game-card {
      background-color: var(--card-bg);
      border-radius: 0.75rem;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .game-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .game-card-header {
      height: 8rem;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .game-card-header.bg-1 { background: linear-gradient(to right, #2196F3, #1976D2); }
    .game-card-header.bg-2 { background: linear-gradient(to right, #FF4081, #C2185B); }
    .game-card-header.bg-3 { background: linear-gradient(to right, #4CAF50, #388E3C); }
    .game-card-header.bg-4 { background: linear-gradient(to right, #FFC107, #FFA000); }

    .game-card-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.1);
    }

    .game-card-icon {
      position: relative;
      z-index: 1;
      font-size: 3rem;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      transition: transform 0.5s ease;
    }

    .game-card:hover .game-card-icon {
      transform: scale(1.25);
    }

    .game-card-body {
      padding: 1rem;
      text-align: center;
    }

    .game-card-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: #1a365d;
    }

    .game-card-desc {
      font-size: 0.875rem;
      color: #333;
    }

    /* لوحة النتائج */
    .scoreboard {
      background-color: var(--card-bg);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .scoreboard-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--primary-color);
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 0.5rem;
    }

    .players-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .player-item {
      background-color: rgba(255, 255, 255, 0.7);
      padding: 0.75rem;
      border-radius: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .player-name {
      font-weight: 500;
    }

    .player-score {
      font-weight: bold;
      background-color: var(--accent-color);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
    }

    /* نموذج إضافة لاعب */
    .add-player-form {
      display: flex;
      margin-bottom: 1rem;
      gap: 0.5rem;
    }

    .add-player-input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 0.5rem;
      font-family: 'Tajawal', sans-serif;
    }

    .add-player-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      font-family: 'Tajawal', sans-serif;
    }

    /* صفحة اللعبة */
    .game-page {
      display: none;
    }

    .game-container {
      background-color: var(--card-bg);
      border-radius: 0.75rem;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .game-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
    }

    .game-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      font-family: 'Tajawal', sans-serif;
      font-size: 1rem;
    }

    .back-button {
      background-color: #ccc;
    }

    .answer-button {
      background-color: var(--accent-color);
    }

    /* التنبيهات */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--accent-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      display: none;
    }

    /* ملف Excel للأسئلة */
    .import-container {
      background-color: var(--card-bg);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-top: 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .import-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--primary-color);
    }

    .import-form {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .import-label {
      display: inline-block;
      background-color: var(--primary-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      cursor: pointer;
    }

    .import-file {
      display: none;
    }

    .clear-button {
      background-color: var(--destructive-color);
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      font-family: 'Tajawal', sans-serif;
    }

    /* التكييف مع الشاشات الصغيرة */
    @media (max-width: 768px) {
      .game-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .subtitle {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- التنبيهات -->
  <div id="notification" class="notification"></div>

  <!-- الصفحة الرئيسية -->
  <div id="home-page" class="container">
    <header>
      <h1>ألعاب الشايب</h1>
      <p class="subtitle">منصة ألعاب تراثية للتجمعات والمناسبات</p>
    </header>

    <!-- شبكة الألعاب -->
    <div class="game-grid" id="game-grid">
      <!-- سيتم إنشاء البطاقات ديناميكياً بواسطة JavaScript -->
    </div>

    <!-- لوحة النتائج -->
    <div class="scoreboard">
      <h2 class="scoreboard-title">لوحة النتائج</h2>
      
      <form id="add-player-form" class="add-player-form">
        <input type="text" id="player-name" class="add-player-input" placeholder="اسم اللاعب" required>
        <button type="submit" class="add-player-button">إضافة لاعب</button>
      </form>
      
      <div class="players-list" id="players-list">
        <!-- سيتم إضافة اللاعبين ديناميكياً -->
      </div>
    </div>

    <!-- استيراد الأسئلة -->
    <div class="import-container">
      <h2 class="import-title">استيراد الأسئلة من ملف Excel</h2>
      <div class="import-form">
        <label for="excel-file" class="import-label">
          <i class="fas fa-file-excel"></i> اختر ملف
        </label>
        <input type="file" id="excel-file" class="import-file" accept=".xlsx,.xls">
        <span id="file-name">لم يتم اختيار ملف</span>
        <button id="clear-questions" class="clear-button">مسح جميع الأسئلة</button>
      </div>
    </div>
  </div>

  <!-- صفحة اللعبة -->
  <div id="game-page" class="game-page container">
    <header>
      <h1 id="game-title">عنوان اللعبة</h1>
    </header>

    <div class="game-container">
      <div id="question-container">
        <h2 id="question-text">السؤال سيظهر هنا</h2>
      </div>
      
      <div id="answer-container" style="display: none;">
        <h3>الإجابة:</h3>
        <p id="answer-text">الإجابة ستظهر هنا</p>
      </div>

      <div class="game-actions">
        <button id="back-button" class="game-button back-button">العودة للرئيسية</button>
        <button id="show-answer" class="game-button answer-button">عرض الإجابة</button>
        <button id="next-question" class="game-button">السؤال التالي</button>
      </div>
    </div>

    <!-- تحديث النتائج -->
    <div class="scoreboard">
      <h2 class="scoreboard-title">تحديث النتائج</h2>
      <div class="players-list" id="update-players-list">
        <!-- سيتم إضافة اللاعبين ديناميكياً -->
      </div>
    </div>
  </div>

  <!-- تضمين XLSX.js لمعالجة ملفات Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <script>
    // البيانات الافتراضية
    const defaultCategories = [
      { id: 1, name: "بحر حرب", icon: "fa-water", description: "قل كلمة تبدأ بالحرف المطلوب" },
      { id: 2, name: "تنقيص حرف", icon: "fa-minus-circle", description: "استبدل حرف لتكوين كلمة جديدة" },
      { id: 3, name: "مشاركة", icon: "fa-share-alt", description: "شارك معلومة أو قصة حسب الموضوع" },
      { id: 4, name: "نادي خطأ", icon: "fa-bath", description: "صحح الأخطاء في الجملة" }
    ];

    // حالة التطبيق
    let state = {
      categories: [],
      questions: [],
      players: [],
      currentCategory: null,
      currentQuestion: null,
      answerVisible: false
    };

    // تهيئة التطبيق من localStorage أو القيم الافتراضية
    function initApp() {
      loadFromLocalStorage();
      renderHomePage();
      showNotification("مرحباً بك في منصة ألعاب الشايب");
      
      // إضافة مستمعات الأحداث
      document.getElementById('add-player-form').addEventListener('submit', handleAddPlayer);
      document.getElementById('back-button').addEventListener('click', navigateToHome);
      document.getElementById('show-answer').addEventListener('click', showAnswer);
      document.getElementById('next-question').addEventListener('click', loadNextQuestion);
      document.getElementById('excel-file').addEventListener('change', handleExcelUpload);
      document.getElementById('clear-questions').addEventListener('click', clearQuestions);
    }

    // حفظ البيانات في localStorage
    function saveToLocalStorage() {
      localStorage.setItem('alshayeb_categories', JSON.stringify(state.categories));
      localStorage.setItem('alshayeb_questions', JSON.stringify(state.questions));
      localStorage.setItem('alshayeb_players', JSON.stringify(state.players));
    }

    // استرجاع البيانات من localStorage
    function loadFromLocalStorage() {
      // استرجاع الفئات
      const savedCategories = localStorage.getItem('alshayeb_categories');
      state.categories = savedCategories ? JSON.parse(savedCategories) : defaultCategories;
      
      // استرجاع الأسئلة
      const savedQuestions = localStorage.getItem('alshayeb_questions');
      state.questions = savedQuestions ? JSON.parse(savedQuestions) : [];
      
      // استرجاع اللاعبين
      const savedPlayers = localStorage.getItem('alshayeb_players');
      state.players = savedPlayers ? JSON.parse(savedPlayers) : [];
    }

    // عرض التنبيهات
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // عرض الصفحة الرئيسية
    function renderHomePage() {
      // عرض فئات الألعاب
      const gameGrid = document.getElementById('game-grid');
      gameGrid.innerHTML = '';
      
      state.categories.forEach((category, index) => {
        const card = document.createElement('div');
        card.className = 'game-card';
        card.onclick = () => navigateToGame(category);
        
        const bgClass = `bg-${(index % 4) + 1}`;
        
        card.innerHTML = `
          <div class="game-card-header ${bgClass}">
            <i class="game-card-icon fas ${category.icon}"></i>
          </div>
          <div class="game-card-body">
            <h3 class="game-card-title">${category.name}</h3>
            <p class="game-card-desc">${category.description}</p>
          </div>
        `;
        
        gameGrid.appendChild(card);
      });
      
      // عرض قائمة اللاعبين
      renderPlayers();
    }

    // عرض قائمة اللاعبين
    function renderPlayers() {
      const playersList = document.getElementById('players-list');
      playersList.innerHTML = '';
      
      state.players.forEach(player => {
        const playerItem = document.createElement('div');
        playerItem.className = 'player-item';
        playerItem.innerHTML = `
          <span class="player-name">${player.name}</span>
          <span class="player-score">${player.score || 0}</span>
        `;
        playersList.appendChild(playerItem);
      });
    }

    // إضافة لاعب جديد
    function handleAddPlayer(e) {
      e.preventDefault();
      const playerNameInput = document.getElementById('player-name');
      const playerName = playerNameInput.value.trim();
      
      if (playerName) {
        // التحقق من عدم وجود اللاعب بنفس الاسم
        if (state.players.some(p => p.name === playerName)) {
          showNotification("يوجد لاعب بهذا الاسم بالفعل");
          return;
        }
        
        // إضافة اللاعب الجديد
        const newPlayer = {
          id: Date.now(),
          name: playerName,
          score: 0
        };
        
        state.players.push(newPlayer);
        saveToLocalStorage();
        renderPlayers();
        
        // إفراغ الحقل
        playerNameInput.value = '';
        showNotification(`تم إضافة اللاعب ${playerName}`);
      }
    }

    // الانتقال إلى صفحة اللعبة
    function navigateToGame(category) {
      // تحديث الفئة الحالية
      state.currentCategory = category;
      
      // عرض صفحة اللعبة وإخفاء الصفحة الرئيسية
      document.getElementById('home-page').style.display = 'none';
      document.getElementById('game-page').style.display = 'block';
      
      // تحديث عنوان اللعبة
      document.getElementById('game-title').textContent = category.name;
      
      // تحميل سؤال
      loadQuestion();
      
      // عرض قائمة اللاعبين لتحديث النتائج
      renderUpdatePlayersList();
    }

    // تحميل سؤال
    function loadQuestion() {
      // البحث عن الأسئلة المرتبطة بالفئة الحالية
      const categoryQuestions = state.questions.filter(q => q.categoryId === state.currentCategory.id);
      
      if (categoryQuestions.length === 0) {
        // لا توجد أسئلة، عرض رسالة
        document.getElementById('question-text').textContent = "لا توجد أسئلة لهذه الفئة. يرجى استيراد الأسئلة من ملف Excel.";
        document.getElementById('answer-container').style.display = 'none';
        document.getElementById('show-answer').style.display = 'none';
        document.getElementById('next-question').style.display = 'none';
        return;
      }
      
      // اختيار سؤال عشوائي
      const randomIndex = Math.floor(Math.random() * categoryQuestions.length);
      state.currentQuestion = categoryQuestions[randomIndex];
      
      // عرض السؤال
      document.getElementById('question-text').textContent = state.currentQuestion.question;
      
      // إخفاء الإجابة
      document.getElementById('answer-container').style.display = 'none';
      document.getElementById('answer-text').textContent = state.currentQuestion.answer;
      
      // إظهار زر عرض الإجابة
      document.getElementById('show-answer').style.display = 'inline-block';
      document.getElementById('next-question').style.display = 'inline-block';
      
      state.answerVisible = false;
    }

    // عرض الإجابة
    function showAnswer() {
      if (!state.currentQuestion) return;
      
      document.getElementById('answer-container').style.display = 'block';
      document.getElementById('show-answer').style.display = 'none';
      state.answerVisible = true;
    }

    // تحميل سؤال آخر
    function loadNextQuestion() {
      loadQuestion();
    }

    // العودة إلى الصفحة الرئيسية
    function navigateToHome() {
      document.getElementById('game-page').style.display = 'none';
      document.getElementById('home-page').style.display = 'block';
    }

    // عرض قائمة اللاعبين لتحديث النتائج
    function renderUpdatePlayersList() {
      const updatePlayersList = document.getElementById('update-players-list');
      updatePlayersList.innerHTML = '';
      
      state.players.forEach(player => {
        const playerRow = document.createElement('div');
        playerRow.className = 'player-item';
        
        const addScoreBtn = document.createElement('button');
        addScoreBtn.textContent = '+';
        addScoreBtn.className = 'game-button';
        addScoreBtn.style.marginRight = '5px';
        addScoreBtn.onclick = () => updatePlayerScore(player, 1);
        
        const name = document.createElement('span');
        name.className = 'player-name';
        name.textContent = player.name;
        
        const score = document.createElement('span');
        score.className = 'player-score';
        score.textContent = player.score || 0;
        
        playerRow.appendChild(addScoreBtn);
        playerRow.appendChild(name);
        playerRow.appendChild(score);
        
        updatePlayersList.appendChild(playerRow);
      });
    }

    // تحديث نتيجة اللاعب
    function updatePlayerScore(player, points) {
      const playerIndex = state.players.findIndex(p => p.id === player.id);
      if (playerIndex !== -1) {
        state.players[playerIndex].score = (state.players[playerIndex].score || 0) + points;
        saveToLocalStorage();
        renderUpdatePlayersList();
        showNotification(`تم إضافة نقطة للاعب ${player.name}`);
      }
    }

    // معالجة استيراد ملف Excel
    function handleExcelUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      document.getElementById('file-name').textContent = file.name;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        
        // افتراض أن الورقة الأولى تحتوي على البيانات
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        
        // تحويل البيانات إلى مصفوفة من الكائنات
        const excelData = XLSX.utils.sheet_to_json(worksheet);
        
        processExcelData(excelData);
      };
      reader.readAsArrayBuffer(file);
    }

    // معالجة بيانات Excel
    function processExcelData(data) {
      if (!data || data.length === 0) {
        showNotification("لم يتم العثور على بيانات في الملف");
        return;
      }
      
      // افتراض تنسيق البيانات: categoryId, question, answer
      const newQuestions = data.map((row, index) => ({
        id: Date.now() + index,
        categoryId: Number(row.categoryId) || 1,
        question: row.question || "سؤال بدون محتوى",
        answer: row.answer || "إجابة بدون محتوى"
      }));
      
      // إضافة الأسئلة الجديدة
      state.questions = [...state.questions, ...newQuestions];
      saveToLocalStorage();
      
      showNotification(`تم استيراد ${newQuestions.length} سؤال بنجاح`);
      
      // إعادة تعيين حقل الملف
      document.getElementById('excel-file').value = '';
      document.getElementById('file-name').textContent = 'لم يتم اختيار ملف';
    }

    // مسح جميع الأسئلة
    function clearQuestions() {
      if (confirm("هل أنت متأكد من رغبتك في مسح جميع الأسئلة؟")) {
        state.questions = [];
        saveToLocalStorage();
        showNotification("تم مسح جميع الأسئلة");
      }
    }

    // تشغيل التطبيق عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>